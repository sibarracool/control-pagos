        document.addEventListener('DOMContentLoaded', function() {
            const loginForm = document.getElementById('loginForm');
            const registerForm = document.getElementById('registerForm');
            const showRegister = document.getElementById('showRegister');
            const showLogin = document.getElementById('showLogin');
            const errorMessage = document.getElementById('errorMessage');
            const registerMessage = document.getElementById('registerMessage');

            // Alternar entre login y registro
            showRegister.addEventListener('click', (e) => {
                e.preventDefault();
                loginForm.classList.add('hidden');
                registerForm.classList.remove('hidden');
            });

            showLogin.addEventListener('click', (e) => {
                e.preventDefault();
                registerForm.classList.add('hidden');
                loginForm.classList.remove('hidden');
            });

            // Manejar login
            loginForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;

                try {
                    errorMessage.classList.add('hidden');
                    
                    // Esperar a que auth esté listo
                    await auth.waitForAuth();
                    
                    await auth.login(email, password);
                } catch (error) {
                    errorMessage.textContent = error.message;
                    errorMessage.classList.remove('hidden');
                }
            });

            // Manejar registro
            registerForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const email = document.getElementById('regEmail').value;
                const password = document.getElementById('regPassword').value;

                try {
                    await auth.register(email, password);
                    registerMessage.textContent = 'Cuenta creada exitosamente. Revisa tu email para confirmar.';
                    registerMessage.classList.remove('hidden');
                } catch (error) {
                    registerMessage.textContent = error.message;
                    registerMessage.classList.remove('hidden');
                    registerMessage.classList.remove('bg-green-50', 'border-green-200', 'text-green-600');
                    registerMessage.classList.add('bg-red-50', 'border-red-200', 'text-red-600');
                }
            });

            // Verificar si ya está autenticado después de que auth esté listo
            setTimeout(async () => {
                await auth.waitForAuth();
                const isAuth = await auth.checkAuth();
                if (isAuth) {
                    console.log('Usuario ya autenticado, redirigiendo al dashboard');
                    window.location.href = 'dashboard.html';
                }
            }, 100);
        });